# Лабораторная работа 3

**Название:** "Разработка драйверов сетевых устройств"

**Цель работы:** Получить знания и навыки разработки драйверов сетевых интерфейсов для операционной системы Linux.

## Описание функциональности драйвера

Во время работы драйвер выводит в кольцевой буфер информацию о пакетах, длина которых меньше 70 байт. Формат сообщения:

```
[  199.838650] Captured IP packet, saddr: 93.184.220.29
[  199.838655] daddr: 10.0.2.15
[  199.838656] Size: 20
```

Где `saddr`: ip адрес отправителя;
`daddr`: ip адрес получателя;
`Size`: размер пакета

При чтении файла `/proc/var5` выводится информация о количестве обработанных и отброшенных пакетов:

```
Processed: 10
Sizes:
0) 0
1) 16
2) 53
3) 40
4) 24
5) 20
6) 20
7) 20
8) 20
9) 20
```

Где `Processed`: количество пакетов, которые подошли по условию;
`Sizes`: размеры пакетов, которые подошли по условию.

## Инструкция по сборке

В корневой директории `lab3` выполнить команду `sudo make`

## Инструкция пользователя

Для загрузки модуля выполнить команду `sudo insmod virt_net_if.ko`

Для проверки кольцевого буфера в отдельном окне консоли выполнить команду: `dmesg`

Для проверки содержимого служебного файла: `cat /proc/var5`

Для удаления модуля: `sudo rmmod virt_net_if`

## Примеры использования

Для того, чтобы драйвер начал работать, необходимо обеспечить трафик на интерфейсе `enp0s3`

Воспользуемся для этого командой `ping`. После загрузки модуля необходимо выполнить:

```
ping -s N 127.0.0.1
```

Где N - размер пакета. Если N <= 70, пакеты будут обрабатываться драйвером и учитываться как `Processed`.
